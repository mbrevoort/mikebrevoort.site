/*! Mike Brevoort (c) 2013-05-18 */
(function(t,e){e.wrapped=t,function(){"use strict";var t,e=$("#likes"),o=e.find("span.count"),a=e.data("page-id"),n=!1,s="mikebrevoort",i="likes",c="ZqUyD4bGcXktf9nj2A2Ixbt5IAMKWzKs";if(location.hostname.match("mike.brevoort.com")&&e.length){var l=function(){var t=$(window).scrollTop();t=t>250?e.addClass("moveme"):e.removeClass("moveme")};if($(window).scroll(function(){t&&clearTimeout(t),t=setTimeout(function(){l()},100)}),localStorage&&localStorage.getItem(a)){var r=JSON.parse(localStorage.getItem(a));r.counted&&e.addClass("counted").find("i").toggleClass("icon-heart-empty icon-heart-full")}if(sessionStorage&&sessionStorage.getItem(a)){var u=JSON.parse(sessionStorage.getItem(a));o.text(u.count)}else $.ajax({url:"https://api.mongolab.com/api/1/databases/"+s+"/collections/"+i+"?apiKey="+c,type:"GET",contentType:"application/json",success:function(t){$.each(t,function(t,e){e.pageId===a&&(o.text(e.count),n=!0),sessionStorage.setItem(e.pageId,JSON.stringify({count:e.count}))}),n||$.ajax({url:"https://api.mongolab.com/api/1/databases/"+s+"/collections/"+i+"?apiKey="+c,data:JSON.stringify({pageId:a,count:0}),type:"POST",contentType:"application/json",success:function(){o.text("0"),sessionStorage.setItem(a,JSON.stringify({count:0}))}})}});e.on("click",function(t){var e=$(this),n=o.text();e.toggleClass("counted").find("i").toggleClass("icon-heart-empty icon-heart-full"),n=e.hasClass("counted")?++n:--n,o.text(n),sessionStorage.setItem(a,JSON.stringify({count:n})),localStorage.setItem(a,JSON.stringify({counted:e.hasClass("counted")?!0:!1})),$.ajax({url:"https://api.mongolab.com/api/1/databases/"+s+"/runCommand?apiKey="+c,data:JSON.stringify({findAndModify:i,query:{pageId:a},update:{$inc:{count:e.hasClass("counted")?1:-1}},upsert:!0}),type:"POST",contentType:"application/json"}),t.preventDefault()})}}()})({},function(){return this}());